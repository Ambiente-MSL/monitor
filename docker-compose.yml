services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: dashboardsocial-backend:latest
    container_name: monitor_backend
    env_file:
    - ${BACKEND_ENV_FILE:-./deploy/backend.env}
    restart: unless-stopped
    ports:
    - 2025:3001
    extra_hosts:
    - host.docker.internal:host-gateway
    networks:
    - internal
    healthcheck:
      test:
      - CMD
      - curl
      - -fsS
      - http://localhost:3001/api/instagram/posts?limit=1
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 120s
  worker:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: dashboardsocial-backend:latest
    container_name: monitor_worker
    env_file:
    - ${BACKEND_ENV_FILE:-./deploy/backend.env}
    command: python scheduler_runner.py
    restart: unless-stopped
    depends_on:
    - backend
    networks:
    - internal
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        REACT_APP_API_URL: https://monitor.mslestrategia.com.br
    image: dashboardsocial-frontend:latest
    container_name: monitor_frontend
    restart: unless-stopped
    depends_on:
    - backend
    ports:
    - 2024:80
    networks:
    - internal
networks:
  internal: null
