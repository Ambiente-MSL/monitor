services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: dashboardsocial-backend:latest
    container_name: monitor_backend
    env_file:
    - ./deploy/backend.env
    environment:
      DATABASE_HOST: 172.17.0.1
      DATABASE_PORT: '5432'
      FRONTEND_ORIGIN: https://monitor.mslestrategia.com.br
      FACEBOOK_APP_ID: '2063845937779150'
      FACEBOOK_APP_SECRET: 817f6bda801530f8f4a50249330618f5
      META_SYNC_AUTOSTART: '0'
      WEB_CONCURRENCY: '2'
    restart: unless-stopped
    ports:
    - 2025:3001
    extra_hosts:
    - host.docker.internal:host-gateway
    networks:
    - internal
    healthcheck:
      test:
      - CMD
      - curl
      - -fsS
      - http://localhost:3001/api/instagram/posts?limit=1
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 120s
  worker:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: dashboardsocial-backend:latest
    container_name: monitor_worker
    env_file:
    - ./deploy/backend.env
    command: python scheduler_runner.py
    restart: unless-stopped
    depends_on:
    - backend
    networks:
    - internal
    environment:
      FACEBOOK_APP_ID: '2063845937779150'
      FACEBOOK_APP_SECRET: 817f6bda801530f8f4a50249330618f5
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        REACT_APP_API_URL: https://monitor.mslestrategia.com.br
    image: dashboardsocial-frontend:latest
    container_name: monitor_frontend
    restart: unless-stopped
    depends_on:
    - backend
    ports:
    - 2024:80
    networks:
    - internal
networks:
  internal: null
